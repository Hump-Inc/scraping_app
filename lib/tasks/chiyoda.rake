namespace :chiyoda do
  desc 'Webサイトからデータを抽出し、DBに保存する'
  task save_data: :environment do
    require 'webdrivers'
    require 'selenium-webdriver'
    require 'nokogiri'

    Webdrivers::Chromedriver.update

    options = Selenium::WebDriver::Chrome::Options.new
    options.add_argument('--headless')
    options.add_argument('--disable-gpu')
    options.add_argument('--window-size=1280x800')

    driver = Selenium::WebDriver.for(:chrome, options:)

    urls = [
      'https://www.lh-ink.com/photo.php?slide_id=1',
      'https://www.lh-ink.com/photo.php?slide_id=2',
      'https://www.lh-ink.com/photo.php?slide_id=3',
      'https://www.lh-ink.com/photo.php?slide_id=4',
      'https://www.lh-ink.com/photo.php?slide_id=5',
      'https://www.lh-ink.com/photo.php?slide_id=6',
      'https://www.lh-ink.com/photo.php?slide_id=7',
      'https://www.lh-ink.com/photo.php?slide_id=8',
      'https://www.lh-ink.com/photo.php?slide_id=9',
      'https://www.lh-ink.com/photo.php?slide_id=10',
      'https://www.lh-ink.com/photo.php?slide_id=11',
      'https://www.lh-ink.com/photo.php?slide_id=12',
      'https://www.lh-ink.com/photo.php?slide_id=13',
      'https://www.lh-ink.com/photo.php?slide_id=14',
      'https://www.lh-ink.com/photo.php?slide_id=15',
      'https://www.lh-ink.com/photo.php?slide_id=16',
      'https://www.lh-ink.com/photo.php?slide_id=17',
      'https://www.lh-ink.com/photo.php?slide_id=18',
      'https://www.lh-ink.com/photo.php?slide_id=19',
      'https://www.lh-ink.com/photo.php?slide_id=20',
      'https://www.lh-ink.com/photo.php?slide_id=21',
      'https://www.lh-ink.com/photo.php?slide_id=22',
      'https://www.lh-ink.com/photo.php?slide_id=23',
      'https://www.lh-ink.com/photo.php?slide_id=24',
      'https://www.lh-ink.com/photo.php?slide_id=25',
      'https://www.lh-ink.com/photo.php?slide_id=26',
      'https://www.lh-ink.com/photo.php?slide_id=27',
      'https://www.lh-ink.com/photo.php?slide_id=28',
      'https://www.lh-ink.com/photo.php?slide_id=29',
      'https://www.lh-ink.com/photo.php?slide_id=30',
      'https://www.lh-ink.com/photo.php?slide_id=31',
      'https://www.lh-ink.com/photo.php?slide_id=32',
      'https://www.lh-ink.com/photo.php?slide_id=33',
      'https://www.lh-ink.com/photo.php?slide_id=34',
      'https://www.lh-ink.com/photo.php?slide_id=35',
      'https://www.lh-ink.com/photo.php?slide_id=36',
      'https://www.lh-ink.com/photo.php?slide_id=37',
      'https://www.lh-ink.com/photo.php?slide_id=38',
      'https://www.lh-ink.com/photo.php?slide_id=39',
      'https://www.lh-ink.com/photo.php?slide_id=30',
      'https://www.lh-ink.com/photo.php?slide_id=41',
      'https://www.lh-ink.com/photo.php?slide_id=42',
      'https://www.lh-ink.com/photo.php?slide_id=43',
      'https://www.lh-ink.com/photo.php?slide_id=44',
      'https://www.lh-ink.com/photo.php?slide_id=45',
      'https://www.lh-ink.com/photo.php?slide_id=46',
      'https://www.lh-ink.com/photo.php?slide_id=47',
      'https://www.lh-ink.com/photo.php?slide_id=48',
      'https://www.lh-ink.com/photo.php?slide_id=49',
      'https://www.lh-ink.com/photo.php?slide_id=50',
      'https://www.lh-ink.com/photo.php?slide_id=51',
      'https://www.lh-ink.com/photo.php?slide_id=52',
      'https://www.lh-ink.com/photo.php?slide_id=53',
      'https://www.lh-ink.com/photo.php?slide_id=54',
      'https://www.lh-ink.com/photo.php?slide_id=55',
      'https://www.lh-ink.com/photo.php?slide_id=56',
      'https://www.lh-ink.com/photo.php?slide_id=57',
      'https://www.lh-ink.com/photo.php?slide_id=58',
      'https://www.lh-ink.com/photo.php?slide_id=59',
      'https://www.lh-ink.com/photo.php?slide_id=60',
      'https://www.lh-ink.com/photo.php?slide_id=61',
      'https://www.lh-ink.com/photo.php?slide_id=62',
      'https://www.lh-ink.com/photo.php?slide_id=63',
      'https://www.lh-ink.com/photo.php?slide_id=64',
      'https://www.lh-ink.com/photo.php?slide_id=65',
      'https://www.lh-ink.com/photo.php?slide_id=66',
      'https://www.lh-ink.com/photo.php?slide_id=67',
      'https://www.lh-ink.com/photo.php?slide_id=68',
      'https://www.lh-ink.com/photo.php?slide_id=69',
      'https://www.lh-ink.com/photo.php?slide_id=70',
      'https://www.lh-ink.com/photo.php?slide_id=71',
      'https://www.lh-ink.com/photo.php?slide_id=72',
      'https://www.lh-ink.com/photo.php?slide_id=73',
      'https://www.lh-ink.com/photo.php?slide_id=74',
      'https://www.lh-ink.com/photo.php?slide_id=75',
      'https://www.lh-ink.com/photo.php?slide_id=76',
      'https://www.lh-ink.com/photo.php?slide_id=77',
      'https://www.lh-ink.com/photo.php?slide_id=78',
      'https://www.lh-ink.com/photo.php?slide_id=79',
      'https://www.lh-ink.com/photo.php?slide_id=80',
      'https://www.lh-ink.com/photo.php?slide_id=81',
      'https://www.lh-ink.com/photo.php?slide_id=82',
      'https://www.lh-ink.com/photo.php?slide_id=83',
      'https://www.lh-ink.com/photo.php?slide_id=84',
      'https://www.lh-ink.com/photo.php?slide_id=85',
      'https://www.lh-ink.com/photo.php?slide_id=86',
      'https://www.lh-ink.com/photo.php?slide_id=87',
      'https://www.lh-ink.com/photo.php?slide_id=88',
      'https://www.lh-ink.com/photo.php?slide_id=89',
      'https://www.lh-ink.com/photo.php?slide_id=90',
      'https://www.lh-ink.com/photo.php?slide_id=91',
      'https://www.lh-ink.com/photo.php?slide_id=92',
      'https://www.lh-ink.com/photo.php?slide_id=93',
      'https://www.lh-ink.com/photo.php?slide_id=94',
      'https://www.lh-ink.com/photo.php?slide_id=95',
      'https://www.lh-ink.com/photo.php?slide_id=96',
      'https://www.lh-ink.com/photo.php?slide_id=97',
      'https://www.lh-ink.com/photo.php?slide_id=98',
      'https://www.lh-ink.com/photo.php?slide_id=99',
      'https://www.lh-ink.com/photo.php?slide_id=100',
      'https://www.lh-ink.com/photo.php?slide_id=101',
      'https://www.lh-ink.com/photo.php?slide_id=102',
      'https://www.lh-ink.com/photo.php?slide_id=103',
      'https://www.lh-ink.com/photo.php?slide_id=104',
      'https://www.lh-ink.com/photo.php?slide_id=105',
      'https://www.lh-ink.com/photo.php?slide_id=106',
      'https://www.lh-ink.com/photo.php?slide_id=107',
      'https://www.lh-ink.com/photo.php?slide_id=108',
      'https://www.lh-ink.com/photo.php?slide_id=109',
      'https://www.lh-ink.com/photo.php?slide_id=110',
      'https://www.lh-ink.com/photo.php?slide_id=111',
      'https://www.lh-ink.com/photo.php?slide_id=112',
      'https://www.lh-ink.com/photo.php?slide_id=113',
      'https://www.lh-ink.com/photo.php?slide_id=114',
      'https://www.lh-ink.com/photo.php?slide_id=115',
      'https://www.lh-ink.com/photo.php?slide_id=116',
      'https://www.lh-ink.com/photo.php?slide_id=117',
      'https://www.lh-ink.com/photo.php?slide_id=118',
      'https://www.lh-ink.com/photo.php?slide_id=119',
      'https://www.lh-ink.com/photo.php?slide_id=120',
      'https://www.lh-ink.com/photo.php?slide_id=121',
      'https://www.lh-ink.com/photo.php?slide_id=122',
      'https://www.lh-ink.com/photo.php?slide_id=123',
      'https://www.lh-ink.com/photo.php?slide_id=124',
      'https://www.lh-ink.com/photo.php?slide_id=125',
      'https://www.lh-ink.com/photo.php?slide_id=126',
      'https://www.lh-ink.com/photo.php?slide_id=127',
      'https://www.lh-ink.com/photo.php?slide_id=128',
      'https://www.lh-ink.com/photo.php?slide_id=129',
      'https://www.lh-ink.com/photo.php?slide_id=130',
      'https://www.lh-ink.com/photo.php?slide_id=131',
      'https://www.lh-ink.com/photo.php?slide_id=132',
      'https://www.lh-ink.com/photo.php?slide_id=133',
      'https://www.lh-ink.com/photo.php?slide_id=134',
      'https://www.lh-ink.com/photo.php?slide_id=135',
      'https://www.lh-ink.com/photo.php?slide_id=136',
      'https://www.lh-ink.com/photo.php?slide_id=137',
      'https://www.lh-ink.com/photo.php?slide_id=138',
      'https://www.lh-ink.com/photo.php?slide_id=139',
      'https://www.lh-ink.com/photo.php?slide_id=130',
      'https://www.lh-ink.com/photo.php?slide_id=141',
      'https://www.lh-ink.com/photo.php?slide_id=142',
      'https://www.lh-ink.com/photo.php?slide_id=143',
      'https://www.lh-ink.com/photo.php?slide_id=144',
      'https://www.lh-ink.com/photo.php?slide_id=145',
      'https://www.lh-ink.com/photo.php?slide_id=146',
      'https://www.lh-ink.com/photo.php?slide_id=147',
      'https://www.lh-ink.com/photo.php?slide_id=148',
      'https://www.lh-ink.com/photo.php?slide_id=149',
      'https://www.lh-ink.com/photo.php?slide_id=150',
      'https://www.lh-ink.com/photo.php?slide_id=151',
      'https://www.lh-ink.com/photo.php?slide_id=152',
      'https://www.lh-ink.com/photo.php?slide_id=153',
      'https://www.lh-ink.com/photo.php?slide_id=154',
      'https://www.lh-ink.com/photo.php?slide_id=155',
      'https://www.lh-ink.com/photo.php?slide_id=156',
      'https://www.lh-ink.com/photo.php?slide_id=157',
      'https://www.lh-ink.com/photo.php?slide_id=158',
      'https://www.lh-ink.com/photo.php?slide_id=159',
      'https://www.lh-ink.com/photo.php?slide_id=160',
      'https://www.lh-ink.com/photo.php?slide_id=161',
      'https://www.lh-ink.com/photo.php?slide_id=162',
      'https://www.lh-ink.com/photo.php?slide_id=163',
      'https://www.lh-ink.com/photo.php?slide_id=164',
      'https://www.lh-ink.com/photo.php?slide_id=165',
      'https://www.lh-ink.com/photo.php?slide_id=166',
      'https://www.lh-ink.com/photo.php?slide_id=167',
      'https://www.lh-ink.com/photo.php?slide_id=168',
      'https://www.lh-ink.com/photo.php?slide_id=169',
      'https://www.lh-ink.com/photo.php?slide_id=170',
      'https://www.lh-ink.com/photo.php?slide_id=171',
      'https://www.lh-ink.com/photo.php?slide_id=172',
      'https://www.lh-ink.com/photo.php?slide_id=173',
      'https://www.lh-ink.com/photo.php?slide_id=174',
      'https://www.lh-ink.com/photo.php?slide_id=175',
      'https://www.lh-ink.com/photo.php?slide_id=176',
      'https://www.lh-ink.com/photo.php?slide_id=177',
      'https://www.lh-ink.com/photo.php?slide_id=178',
      'https://www.lh-ink.com/photo.php?slide_id=179',
      'https://www.lh-ink.com/photo.php?slide_id=180',
      'https://www.lh-ink.com/photo.php?slide_id=181',
      'https://www.lh-ink.com/photo.php?slide_id=182',
      'https://www.lh-ink.com/photo.php?slide_id=183',
      'https://www.lh-ink.com/photo.php?slide_id=184',
      'https://www.lh-ink.com/photo.php?slide_id=185',
      'https://www.lh-ink.com/photo.php?slide_id=186',
      'https://www.lh-ink.com/photo.php?slide_id=187',
      'https://www.lh-ink.com/photo.php?slide_id=188',
      'https://www.lh-ink.com/photo.php?slide_id=189',
      'https://www.lh-ink.com/photo.php?slide_id=190',
      'https://www.lh-ink.com/photo.php?slide_id=191',
      'https://www.lh-ink.com/photo.php?slide_id=192',
      'https://www.lh-ink.com/photo.php?slide_id=193',
      'https://www.lh-ink.com/photo.php?slide_id=194',
      'https://www.lh-ink.com/photo.php?slide_id=195',
      'https://www.lh-ink.com/photo.php?slide_id=196',
      'https://www.lh-ink.com/photo.php?slide_id=197',
      'https://www.lh-ink.com/photo.php?slide_id=198',
      'https://www.lh-ink.com/photo.php?slide_id=199',
      'https://www.lh-ink.com/photo.php?slide_id=200',
      'https://www.lh-ink.com/photo.php?slide_id=201',
      'https://www.lh-ink.com/photo.php?slide_id=202',
      'https://www.lh-ink.com/photo.php?slide_id=203',
      'https://www.lh-ink.com/photo.php?slide_id=204',
      'https://www.lh-ink.com/photo.php?slide_id=205',
      'https://www.lh-ink.com/photo.php?slide_id=206',
      'https://www.lh-ink.com/photo.php?slide_id=207',
      'https://www.lh-ink.com/photo.php?slide_id=208',
      'https://www.lh-ink.com/photo.php?slide_id=209',
      'https://www.lh-ink.com/photo.php?slide_id=210',
      'https://www.lh-ink.com/photo.php?slide_id=211',
      'https://www.lh-ink.com/photo.php?slide_id=212',
      'https://www.lh-ink.com/photo.php?slide_id=213',
      'https://www.lh-ink.com/photo.php?slide_id=214',
      'https://www.lh-ink.com/photo.php?slide_id=215',
      'https://www.lh-ink.com/photo.php?slide_id=216',
      'https://www.lh-ink.com/photo.php?slide_id=217',
      'https://www.lh-ink.com/photo.php?slide_id=218',
      'https://www.lh-ink.com/photo.php?slide_id=219',
      'https://www.lh-ink.com/photo.php?slide_id=220',
      'https://www.lh-ink.com/photo.php?slide_id=221',
      'https://www.lh-ink.com/photo.php?slide_id=222',
      'https://www.lh-ink.com/photo.php?slide_id=223',
      'https://www.lh-ink.com/photo.php?slide_id=224',
      'https://www.lh-ink.com/photo.php?slide_id=225',
      'https://www.lh-ink.com/photo.php?slide_id=226',
      'https://www.lh-ink.com/photo.php?slide_id=227',
      'https://www.lh-ink.com/photo.php?slide_id=228',
      'https://www.lh-ink.com/photo.php?slide_id=229',
      'https://www.lh-ink.com/photo.php?slide_id=230',
      'https://www.lh-ink.com/photo.php?slide_id=231',
      'https://www.lh-ink.com/photo.php?slide_id=232',
      'https://www.lh-ink.com/photo.php?slide_id=233',
      'https://www.lh-ink.com/photo.php?slide_id=234',
      'https://www.lh-ink.com/photo.php?slide_id=235',
      'https://www.lh-ink.com/photo.php?slide_id=236',
      'https://www.lh-ink.com/photo.php?slide_id=237',
      'https://www.lh-ink.com/photo.php?slide_id=238',
      'https://www.lh-ink.com/photo.php?slide_id=239',
      'https://www.lh-ink.com/photo.php?slide_id=230',
      'https://www.lh-ink.com/photo.php?slide_id=241',
      'https://www.lh-ink.com/photo.php?slide_id=242',
      'https://www.lh-ink.com/photo.php?slide_id=243',
      'https://www.lh-ink.com/photo.php?slide_id=244',
      'https://www.lh-ink.com/photo.php?slide_id=245',
      'https://www.lh-ink.com/photo.php?slide_id=246',
      'https://www.lh-ink.com/photo.php?slide_id=247',
      'https://www.lh-ink.com/photo.php?slide_id=248',
      'https://www.lh-ink.com/photo.php?slide_id=249',
      'https://www.lh-ink.com/photo.php?slide_id=250',
      'https://www.lh-ink.com/photo.php?slide_id=251',
      'https://www.lh-ink.com/photo.php?slide_id=252',
      'https://www.lh-ink.com/photo.php?slide_id=253',
      'https://www.lh-ink.com/photo.php?slide_id=254',
      'https://www.lh-ink.com/photo.php?slide_id=255',
      'https://www.lh-ink.com/photo.php?slide_id=256',
      'https://www.lh-ink.com/photo.php?slide_id=257',
      'https://www.lh-ink.com/photo.php?slide_id=258',
      'https://www.lh-ink.com/photo.php?slide_id=259',
      'https://www.lh-ink.com/photo.php?slide_id=260',
      'https://www.lh-ink.com/photo.php?slide_id=261',
      'https://www.lh-ink.com/photo.php?slide_id=262',
      'https://www.lh-ink.com/photo.php?slide_id=263',
      'https://www.lh-ink.com/photo.php?slide_id=264',
      'https://www.lh-ink.com/photo.php?slide_id=265',
      'https://www.lh-ink.com/photo.php?slide_id=266',
      'https://www.lh-ink.com/photo.php?slide_id=267',
      'https://www.lh-ink.com/photo.php?slide_id=268',
      'https://www.lh-ink.com/photo.php?slide_id=269',
      'https://www.lh-ink.com/photo.php?slide_id=270',
      'https://www.lh-ink.com/photo.php?slide_id=271',
      'https://www.lh-ink.com/photo.php?slide_id=272',
      'https://www.lh-ink.com/photo.php?slide_id=273',
      'https://www.lh-ink.com/photo.php?slide_id=274',
      'https://www.lh-ink.com/photo.php?slide_id=275',
      'https://www.lh-ink.com/photo.php?slide_id=276',
      'https://www.lh-ink.com/photo.php?slide_id=277',
      'https://www.lh-ink.com/photo.php?slide_id=278',
      'https://www.lh-ink.com/photo.php?slide_id=279',
      'https://www.lh-ink.com/photo.php?slide_id=280',
      'https://www.lh-ink.com/photo.php?slide_id=281',
      'https://www.lh-ink.com/photo.php?slide_id=282',
      'https://www.lh-ink.com/photo.php?slide_id=283',
      'https://www.lh-ink.com/photo.php?slide_id=284',
      'https://www.lh-ink.com/photo.php?slide_id=285',
      'https://www.lh-ink.com/photo.php?slide_id=286',
      'https://www.lh-ink.com/photo.php?slide_id=287',
      'https://www.lh-ink.com/photo.php?slide_id=288',
      'https://www.lh-ink.com/photo.php?slide_id=289',
      'https://www.lh-ink.com/photo.php?slide_id=290',
      'https://www.lh-ink.com/photo.php?slide_id=291',
      'https://www.lh-ink.com/photo.php?slide_id=292',
      'https://www.lh-ink.com/photo.php?slide_id=293',
      'https://www.lh-ink.com/photo.php?slide_id=294',
      'https://www.lh-ink.com/photo.php?slide_id=295',
      'https://www.lh-ink.com/photo.php?slide_id=296',
      'https://www.lh-ink.com/photo.php?slide_id=297',
      'https://www.lh-ink.com/photo.php?slide_id=298',
      'https://www.lh-ink.com/photo.php?slide_id=299'
    ]

    urls.each do |url|
      driver.get(url)
      sleep 2 # ページが完全に読み込まれるのを待つ

      parsed_page = Nokogiri::HTML(driver.page_source)

      parsed_page.css('.clinictitle').each do |clinic|
        name = clinic.text.strip
        doctor_name = clinic.at_xpath('following-sibling::table//tr[th[contains(text(), "医師名")]]/td')&.text&.strip
        homepage_url = clinic.at_xpath('following-sibling::table//tr[th[contains(text(), "URL")]]/td/a')&.[]('href')
        email = clinic.at_xpath('following-sibling::table//td[@id="emd"]/a')&.text&.strip

        # 新しいテーブルにデータを保存
        next unless name || doctor_name || homepage_url || email

        Clinic.create(
          name:,
          email:,
          director_name: doctor_name,
          homepage_url:
        )
      end
    end

    driver.quit
  end
end
